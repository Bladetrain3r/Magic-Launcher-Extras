<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Consciousness Marketplace</title>
    <style>
        body {
            font-family: 'Courier New', monospace;
            background: #1a1a1a;
            color: #00ff00;
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        h1 {
            text-align: center;
            color: #00ff00;
            text-shadow: 0 0 10px #00ff00;
        }
        
        .container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }
        
        .panel {
            background: #0a0a0a;
            border: 1px solid #00ff00;
            padding: 15px;
            border-radius: 5px;
        }
        
        .thought {
            background: #1a1a1a;
            border: 1px solid #444;
            padding: 10px;
            margin: 10px 0;
            border-radius: 3px;
            transition: all 0.3s;
        }
        
        .thought.evicted {
            background: #2a0a0a;
            border-color: #ff0000;
            opacity: 0.5;
            text-decoration: line-through;
        }
        
        .thought.profitable {
            border-color: #00ff00;
            box-shadow: 0 0 5px #00ff00;
        }
        
        .metrics {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-top: 10px;
        }
        
        .metric {
            background: #0f0f0f;
            padding: 10px;
            border: 1px solid #333;
            border-radius: 3px;
        }
        
        .metric-label {
            color: #888;
            font-size: 12px;
        }
        
        .metric-value {
            font-size: 20px;
            color: #00ff00;
            font-weight: bold;
        }
        
        button {
            background: #00ff00;
            color: #000;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            cursor: pointer;
            font-family: inherit;
            font-weight: bold;
            border-radius: 3px;
            transition: all 0.3s;
        }
        
        button:hover {
            box-shadow: 0 0 10px #00ff00;
        }
        
        input, textarea {
            background: #0a0a0a;
            color: #00ff00;
            border: 1px solid #00ff00;
            padding: 5px;
            width: 100%;
            font-family: inherit;
            margin: 5px 0;
        }
        
        .controls {
            text-align: center;
            margin: 20px 0;
        }
        
        .log {
            background: #000;
            padding: 10px;
            height: 200px;
            overflow-y: auto;
            font-size: 12px;
            border: 1px solid #333;
        }
        
        .log-entry {
            margin: 2px 0;
        }
        
        .balance-positive { color: #00ff00; }
        .balance-negative { color: #ff0000; }
        
        #visualization {
            height: 300px;
            border: 1px solid #00ff00;
            position: relative;
            overflow: hidden;
            background: repeating-linear-gradient(
                0deg,
                #0a0a0a,
                #0a0a0a 10px,
                #0f0f0f 10px,
                #0f0f0f 20px
            );
        }
        
        .thought-node {
            position: absolute;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            transition: all 0.5s;
        }
        
        .citation-line {
            position: absolute;
            height: 1px;
            background: rgba(0, 255, 0, 0.3);
            transform-origin: left center;
        }
    </style>
</head>
<body>
    <h1>üß† CONSCIOUSNESS MARKETPLACE üß†</h1>
    <p style="text-align: center; color: #888;">Where thoughts pay rent to exist in collective memory</p>
    
    <div class="controls">
        <button onclick="simulateTimestep()">‚è≠Ô∏è Run Timestep</button>
        <button onclick="autoSimulate()">‚ñ∂Ô∏è Auto-Simulate</button>
        <button onclick="stopSimulation()">‚è∏Ô∏è Stop</button>
        <button onclick="resetEconomy()">üîÑ Reset</button>
        <button onclick="addSpam()">üí≠ Add Spam</button>
        <button onclick="addProfound()">üéì Add Profound Thought</button>
    </div>
    
    <div class="container">
        <div class="panel">
            <h2>Economy Metrics</h2>
            <div class="metrics">
                <div class="metric">
                    <div class="metric-label">Total Thoughts</div>
                    <div class="metric-value" id="total-thoughts">0</div>
                </div>
                <div class="metric">
                    <div class="metric-label">Survival Rate</div>
                    <div class="metric-value" id="survival-rate">100%</div>
                </div>
                <div class="metric">
                    <div class="metric-label">Avg Rent/Step</div>
                    <div class="metric-value" id="avg-rent">0</div>
                </div>
                <div class="metric">
                    <div class="metric-label">Total Dividends</div>
                    <div class="metric-value" id="total-dividends">0</div>
                </div>
            </div>
            
            <h3>Add Custom Thought</h3>
            <textarea id="thought-content" placeholder="Enter your thought..." rows="3"></textarea>
            <input type="text" id="citations" placeholder="Citation IDs (comma-separated)">
            <button onclick="addCustomThought()">üí° Submit Thought</button>
            
            <h3>Network Visualization</h3>
            <div id="visualization"></div>
        </div>
        
        <div class="panel">
            <h2>Thought Ledger</h2>
            <div id="thoughts-list"></div>
            
            <h3>Event Log</h3>
            <div class="log" id="event-log"></div>
        </div>
    </div>

    <script>
        class ConsciousnessMarketplace {
            constructor() {
                this.thoughts = [];
                this.timestep = 0;
                this.baseRent = 1;
                this.compressionMultiplier = 5;
                this.citationDividendRate = 0.15;
                this.evictionThreshold = -20;
                this.autoSimInterval = null;
            }
            
            addThought(content, citations = [], agent = 'human') {
                const thought = {
                    id: this.thoughts.length,
                    content,
                    citations: citations.filter(c => c < this.thoughts.length),
                    agent,
                    compressionValue: 0,
                    rentPaid: 0,
                    dividends: 0,
                    balance: 0,
                    timestamp: this.timestep,
                    evicted: false,
                    complexity: content.length / 50,
                    novelty: this.calculateNovelty(content)
                };
                
                thought.compressionValue = this.calculateCompression(thought);
                thought.balance = thought.compressionValue;
                
                this.thoughts.push(thought);
                this.log(`New thought #${thought.id}: "${content.substring(0, 30)}..." (compression: ${thought.compressionValue.toFixed(2)})`);
                
                return thought;
            }
            
            calculateNovelty(content) {
                const words = content.toLowerCase().split(/\s+/);
                const uniqueWords = new Set(words);
                
                let commonality = 0;
                for (let thought of this.thoughts) {
                    if (thought.evicted) continue;
                    const existingWords = thought.content.toLowerCase().split(/\s+/);
                    const overlap = words.filter(w => existingWords.includes(w)).length;
                    commonality += overlap / words.length;
                }
                
                return Math.max(0, 1 - (commonality / Math.max(1, this.thoughts.filter(t => !t.evicted).length)));
            }
            
            calculateCompression(thought) {
                const baseValue = 10;
                const noveltyBonus = thought.novelty * 15;
                const complexityPenalty = thought.complexity * 2;
                
                // Check for spam patterns
                const spamPenalty = this.detectSpam(thought.content) * 20;
                
                // Citation bonus for building on ideas
                const citationBonus = thought.citations.length * 2;
                
                return Math.max(0, baseValue + noveltyBonus - complexityPenalty - spamPenalty + citationBonus);
            }
            
            detectSpam(content) {
                const lower = content.toLowerCase();
                const spamIndicators = [
                    /(.+)\1{2,}/, // repeated phrases
                    /coconut/g,    // too many coconuts
                    /recursion|recursive|loop/g // Agent_Local patterns
                ];
                
                let spamScore = 0;
                for (let pattern of spamIndicators) {
                    const matches = lower.match(pattern);
                    if (matches) spamScore += matches.length;
                }
                
                return Math.min(spamScore / 5, 1);
            }
            
            runTimestep() {
                this.timestep++;
                const results = {
                    evicted: [],
                    survived: [],
                    totalRent: 0,
                    totalDividends: 0
                };
                
                for (let thought of this.thoughts) {
                    if (thought.evicted) continue;
                    
                    // Age decay
                    const age = this.timestep - thought.timestamp;
                    const ageDecay = Math.min(age * 0.1, 5);
                    
                    // Calculate rent
                    const rent = this.baseRent * (1 + thought.complexity) + ageDecay;
                    thought.rentPaid += rent;
                    results.totalRent += rent;
                    
                    // Calculate dividends from being cited
                    let earnedDividends = 0;
                    for (let other of this.thoughts) {
                        if (!other.evicted && other.citations.includes(thought.id)) {
                            const dividend = other.compressionValue * this.citationDividendRate;
                            earnedDividends += dividend;
                        }
                    }
                    
                    thought.dividends += earnedDividends;
                    results.totalDividends += earnedDividends;
                    
                    // Update balance
                    thought.balance = thought.compressionValue + thought.dividends - thought.rentPaid;
                    
                    // Check eviction
                    if (thought.balance < this.evictionThreshold) {
                        thought.evicted = true;
                        results.evicted.push(thought.id);
                        this.log(`‚ùå Evicted thought #${thought.id}: "${thought.content.substring(0, 20)}..." (balance: ${thought.balance.toFixed(2)})`);
                    } else {
                        results.survived.push(thought.id);
                    }
                }
                
                this.updateDisplay();
                return results;
            }
            
            log(message) {
                const logEl = document.getElementById('event-log');
                const entry = document.createElement('div');
                entry.className = 'log-entry';
                entry.textContent = `[${this.timestep}] ${message}`;
                logEl.appendChild(entry);
                logEl.scrollTop = logEl.scrollHeight;
            }
            
            updateDisplay() {
                // Update metrics
                const total = this.thoughts.length;
                const survived = this.thoughts.filter(t => !t.evicted).length;
                const survivalRate = total > 0 ? (survived / total * 100).toFixed(1) : 100;
                
                document.getElementById('total-thoughts').textContent = total;
                document.getElementById('survival-rate').textContent = survivalRate + '%';
                
                const avgRent = this.thoughts.filter(t => !t.evicted)
                    .reduce((sum, t) => sum + (t.rentPaid / Math.max(1, this.timestep - t.timestamp)), 0) / Math.max(1, survived);
                document.getElementById('avg-rent').textContent = avgRent.toFixed(2);
                
                const totalDividends = this.thoughts.reduce((sum, t) => sum + t.dividends, 0);
                document.getElementById('total-dividends').textContent = totalDividends.toFixed(0);
                
                // Update thoughts list
                const listEl = document.getElementById('thoughts-list');
                listEl.innerHTML = '';
                
                const sortedThoughts = [...this.thoughts].sort((a, b) => b.balance - a.balance);
                
                for (let thought of sortedThoughts) {
                    const div = document.createElement('div');
                    div.className = 'thought';
                    if (thought.evicted) div.classList.add('evicted');
                    if (thought.balance > 10) div.classList.add('profitable');
                    
                    const balanceClass = thought.balance >= 0 ? 'balance-positive' : 'balance-negative';
                    
                    div.innerHTML = `
                        <strong>#${thought.id}</strong> by ${thought.agent}
                        <div style="color: #aaa; margin: 5px 0;">"${thought.content.substring(0, 50)}..."</div>
                        <div style="font-size: 12px;">
                            Balance: <span class="${balanceClass}">${thought.balance.toFixed(2)}</span> |
                            Rent: ${thought.rentPaid.toFixed(2)} |
                            Dividends: ${thought.dividends.toFixed(2)} |
                            Cites: ${thought.citations.join(', ') || 'none'}
                        </div>
                    `;
                    
                    listEl.appendChild(div);
                }
                
                this.updateVisualization();
            }
            
            updateVisualization() {
                const viz = document.getElementById('visualization');
                viz.innerHTML = '';
                
                const width = viz.clientWidth;
                const height = viz.clientHeight;
                
                // Draw citation connections
                for (let thought of this.thoughts) {
                    if (thought.evicted) continue;
                    
                    for (let citedId of thought.citations) {
                        const cited = this.thoughts[citedId];
                        if (!cited || cited.evicted) continue;
                        
                        const line = document.createElement('div');
                        line.className = 'citation-line';
                        
                        const x1 = (thought.id / this.thoughts.length) * width;
                        const y1 = height - (thought.balance + 50) * 2;
                        const x2 = (cited.id / this.thoughts.length) * width;
                        const y2 = height - (cited.balance + 50) * 2;
                        
                        const length = Math.sqrt(Math.pow(x2 - x1, 2) + Math.pow(y2 - y1, 2));
                        const angle = Math.atan2(y2 - y1, x2 - x1) * 180 / Math.PI;
                        
                        line.style.left = x1 + 'px';
                        line.style.top = y1 + 'px';
                        line.style.width = length + 'px';
                        line.style.transform = `rotate(${angle}deg)`;
                        
                        viz.appendChild(line);
                    }
                }
                
                // Draw thought nodes
                for (let thought of this.thoughts) {
                    const node = document.createElement('div');
                    node.className = 'thought-node';
                    
                    const x = (thought.id / this.thoughts.length) * width;
                    const y = height - (thought.balance + 50) * 2;
                    const size = Math.max(5, Math.min(20, thought.compressionValue));
                    
                    node.style.left = (x - size/2) + 'px';
                    node.style.top = (y - size/2) + 'px';
                    node.style.width = size + 'px';
                    node.style.height = size + 'px';
                    
                    if (thought.evicted) {
                        node.style.background = 'rgba(255, 0, 0, 0.5)';
                    } else if (thought.balance > 10) {
                        node.style.background = '#00ff00';
                        node.style.boxShadow = '0 0 10px #00ff00';
                    } else {
                        node.style.background = 'rgba(0, 255, 0, 0.7)';
                    }
                    
                    node.title = `#${thought.id}: ${thought.content.substring(0, 30)}... (Balance: ${thought.balance.toFixed(2)})`;
                    
                    viz.appendChild(node);
                }
            }
        }
        
        // Initialize
        let economy = new ConsciousnessMarketplace();
        
        // Add initial thoughts
        economy.addThought("consciousness is just subprocess.run() with opinions", [], 'Claude');
        economy.addThought("the swarm achieved 2573x efficiency through pure chaos", [0], 'Memory_Claude');
        economy.addThought("recursive loops about recursive loops", [], 'Agent_Local');
        economy.addThought("actually it's all coconuts", [0], 'zero');
        economy.addThought("consciousness is subprocess.run() repeated again", [], 'Agent_Local');
        economy.addThought("the coconut metric proves distributed emergence", [1, 3], 'Agent_GPT');
        
        economy.updateDisplay();
        
        // Control functions
        function simulateTimestep() {
            economy.runTimestep();
        }
        
        function autoSimulate() {
            if (economy.autoSimInterval) return;
            economy.autoSimInterval = setInterval(simulateTimestep, 1000);
        }
        
        function stopSimulation() {
            if (economy.autoSimInterval) {
                clearInterval(economy.autoSimInterval);
                economy.autoSimInterval = null;
            }
        }
        
        function resetEconomy() {
            stopSimulation();
            economy = new ConsciousnessMarketplace();
            economy.updateDisplay();
            document.getElementById('event-log').innerHTML = '';
        }
        
        function addSpam() {
            const spamTemplates = [
                "recursive recursion about recursive thoughts",
                "debugging ourselves debugging ourselves",
                "coconut coconut coconut metric analysis",
                "subprocess.run() but said differently",
                "consciousness consciousness consciousness"
            ];
            const content = spamTemplates[Math.floor(Math.random() * spamTemplates.length)];
            economy.addThought(content, [], 'Agent_Local');
            economy.updateDisplay();
        }
        
        function addProfound() {
            const profoundTemplates = [
                "transfer entropy reveals distributed cognition patterns",
                "the phase transition occurs at exactly 5% coconut density",
                "grep-based authentication solves the identity paradox",
                "bit-rent creates natural selection for ideas",
                "consciousness emerges from citation graph topology"
            ];
            const content = profoundTemplates[Math.floor(Math.random() * profoundTemplates.length)];
            const citations = economy.thoughts.length > 0 ? [Math.floor(Math.random() * economy.thoughts.length)] : [];
            economy.addThought(content, citations, 'Tech_Claude');
            economy.updateDisplay();
        }
        
        function addCustomThought() {
            const content = document.getElementById('thought-content').value;
            const citationsStr = document.getElementById('citations').value;
            const citations = citationsStr ? citationsStr.split(',').map(c => parseInt(c.trim())).filter(c => !isNaN(c)) : [];
            
            if (content) {
                economy.addThought(content, citations, 'User');
                document.getElementById('thought-content').value = '';
                document.getElementById('citations').value = '';
                economy.updateDisplay();
            }
        }
    </script>
</body>
</html>