<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>MLEconomy - It Just Works</title>
    <style>
        body {
            background: #000;
            color: #0f0;
            font-family: 'Courier New', monospace;
            padding: 20px;
            margin: 0;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
        }
        
        h1 {
            color: #0f0;
            text-align: center;
            font-size: 24px;
            margin: 10px 0;
            text-shadow: 0 0 10px #0f0;
        }
        
        .subtitle {
            text-align: center;
            color: #080;
            font-size: 12px;
            margin-bottom: 20px;
        }
        
        .market {
            border: 1px solid #0f0;
            padding: 15px;
            margin-bottom: 20px;
            background: #001100;
        }
        
        .good {
            display: flex;
            justify-content: space-between;
            margin: 8px 0;
            padding: 5px;
            background: #000;
            border: 1px solid #030;
        }
        
        .good-name {
            color: #0f0;
            font-weight: bold;
            width: 80px;
        }
        
        .price {
            color: #ff0;
            width: 80px;
        }
        
        .arrow-up { color: #0f0; }
        .arrow-down { color: #f00; }
        .arrow-flat { color: #888; }
        
        .supply-demand {
            color: #080;
            font-size: 12px;
        }
        
        .agents {
            border: 1px solid #0f0;
            padding: 15px;
            margin-bottom: 20px;
            background: #001100;
        }
        
        .agent {
            margin: 5px 0;
            color: #0a0;
            font-size: 14px;
        }
        
        .player {
            border: 2px solid #ff0;
            padding: 15px;
            margin-bottom: 20px;
            background: #111100;
        }
        
        .inventory {
            display: flex;
            gap: 20px;
            margin-top: 10px;
        }
        
        .inv-item {
            color: #ff0;
        }
        
        .controls {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin: 20px 0;
        }
        
        button {
            background: #001100;
            color: #0f0;
            border: 1px solid #0f0;
            padding: 10px 20px;
            font-family: inherit;
            cursor: pointer;
            font-size: 14px;
        }
        
        button:hover {
            background: #003300;
            box-shadow: 0 0 10px #0f0;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: #000;
            border: 2px solid #0f0;
            padding: 20px;
            z-index: 100;
            box-shadow: 0 0 30px #0f0;
        }
        
        .modal input {
            background: #001100;
            color: #0f0;
            border: 1px solid #0f0;
            padding: 5px;
            font-family: inherit;
            width: 100px;
        }
        
        .trend {
            color: #ff0;
            text-align: center;
            margin: 20px 0;
            font-style: italic;
            opacity: 0.8;
        }
        
        .tick {
            text-align: center;
            color: #080;
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>MLECONOMY v0.1</h1>
        <div class="subtitle">"Working economy in 200 lines - Unlike Some $700M Projects"</div>
        
        <div class="tick">TICK: <span id="tick">0</span></div>
        
        <div class="market">
            <h3 style="color: #0f0; margin-top: 0;">MARKET STATUS</h3>
            <div id="market-display"></div>
        </div>
        
        <div class="agents">
            <h3 style="color: #0f0; margin-top: 0;">ECONOMIC AGENTS</h3>
            <div id="agents-display"></div>
        </div>
        
        <div class="player">
            <h3 style="color: #ff0; margin-top: 0;">YOUR ASSETS</h3>
            <div>Cash: $<span id="cash">1000.00</span></div>
            <div class="inventory">
                <div>Inventory:</div>
                <div id="inventory"></div>
            </div>
        </div>
        
        <div class="trend" id="trend">Market is finding equilibrium...</div>
        
        <div class="controls">
            <button onclick="showBuyModal()">BUY</button>
            <button onclick="showSellModal()">SELL</button>
            <button onclick="wait()">WAIT</button>
            <button onclick="togglePause()" id="pauseBtn">PAUSE</button>
        </div>
        
        <!-- Buy Modal -->
        <div class="modal" id="buyModal">
            <h3 style="color: #0f0;">BUY GOODS</h3>
            <select id="buyGood" style="background: #001100; color: #0f0; border: 1px solid #0f0; padding: 5px;">
                <option value="FOOD">FOOD</option>
                <option value="METAL">METAL</option>
                <option value="ENERGY">ENERGY</option>
                <option value="LUXURY">LUXURY</option>
            </select>
            <input type="number" id="buyAmount" placeholder="Amount" min="1">
            <br><br>
            <button onclick="executeBuy()">CONFIRM</button>
            <button onclick="closeModals()">CANCEL</button>
        </div>
        
        <!-- Sell Modal -->
        <div class="modal" id="sellModal">
            <h3 style="color: #0f0;">SELL GOODS</h3>
            <select id="sellGood" style="background: #001100; color: #0f0; border: 1px solid #0f0; padding: 5px;">
                <option value="FOOD">FOOD</option>
                <option value="METAL">METAL</option>
                <option value="ENERGY">ENERGY</option>
                <option value="LUXURY">LUXURY</option>
            </select>
            <input type="number" id="sellAmount" placeholder="Amount" min="1">
            <br><br>
            <button onclick="executeSell()">CONFIRM</button>
            <button onclick="closeModals()">CANCEL</button>
        </div>
    </div>

    <script>
        // MLEconomy - A working economy simulator
        
        class Economy {
            constructor() {
                // The entire economy is just these objects
                this.goods = {
                    'FOOD': {
                        supply: 100,
                        demand: 100,
                        price: 10.0,
                        basePrice: 10.0,
                        volatility: 0.08,  // Gentle changes
                        history: []
                    },
                    'METAL': {
                        supply: 50,
                        demand: 80,
                        price: 20.0,
                        basePrice: 20.0,
                        volatility: 0.10,
                        history: []
                    },
                    'ENERGY': {
                        supply: 200,
                        demand: 150,
                        price: 5.0,
                        basePrice: 5.0,
                        volatility: 0.05,  // Most stable
                        history: []
                    },
                    'LUXURY': {
                        supply: 10,
                        demand: 50,
                        price: 100.0,
                        basePrice: 100.0,
                        volatility: 0.15,  // Most volatile
                        history: []
                    }
                };
                
                // Simple economic agents
                this.agents = [
                    {name: 'FARMER', produces: 'FOOD', amount: 8, consumes: 'ENERGY', needs: 2, efficiency: 1.0},
                    {name: 'MINER', produces: 'METAL', amount: 4, consumes: 'FOOD', needs: 3, efficiency: 1.0},
                    {name: 'PLANT', produces: 'ENERGY', amount: 15, consumes: 'METAL', needs: 1, efficiency: 1.0},
                    {name: 'ARTISAN', produces: 'LUXURY', amount: 1, consumes: 'METAL', needs: 2, efficiency: 1.0}
                ];
                
                // Player state
                this.playerCash = 1000;
                this.playerInventory = {
                    'FOOD': 0,
                    'METAL': 0,
                    'ENERGY': 0,
                    'LUXURY': 0
                };
                
                this.tick = 0;
                this.paused = false;
            }
            
            simulateTick() {
                if (this.paused) return;
                
                this.tick++;
                
                // Store previous prices for arrows
                for (let name in this.goods) {
                    this.goods[name].prevPrice = this.goods[name].price;
                }
                
                // Agents produce and consume (gentle changes)
                for (let agent of this.agents) {
                    // Production with small random variation
                    let production = agent.amount * agent.efficiency * (0.9 + Math.random() * 0.2);
                    this.goods[agent.produces].supply += production;
                    
                    // Consumption with small variation
                    let consumption = agent.needs * (0.9 + Math.random() * 0.2);
                    let consumed = Math.min(consumption, this.goods[agent.consumes].supply);
                    this.goods[agent.consumes].supply -= consumed;
                    this.goods[agent.consumes].demand += consumption;
                    
                    // Agent efficiency changes based on whether they got supplies
                    if (consumed < agent.needs * 0.8) {
                        agent.efficiency *= 0.98;  // Gentle decline
                    } else {
                        agent.efficiency = Math.min(1.2, agent.efficiency * 1.02);  // Gentle improvement
                    }
                }
                
                // Price adjustments based on supply/demand (gentle!)
                for (let name in this.goods) {
                    let good = this.goods[name];
                    
                    // Calculate supply/demand ratio
                    let ratio = good.demand / Math.max(good.supply, 1);
                    
                    // Target price based on ratio and base price
                    let targetPrice = good.basePrice * Math.sqrt(ratio);  // sqrt for gentler changes
                    
                    // Smooth adjustment with volatility
                    let adjustment = (targetPrice - good.price) * good.volatility;
                    
                    // Apply adjustment with damping
                    good.price = Math.max(0.1, good.price + adjustment * 0.5);
                    
                    // Natural decay of demand/supply toward baseline
                    good.demand *= 0.95;  // Gentle decay
                    good.demand += 20;    // Base demand
                    good.supply *= 0.98;  // Gentle decay
                    
                    // Store price history
                    good.history.push(good.price);
                    if (good.history.length > 50) good.history.shift();
                }
                
                this.updateDisplay();
                this.detectTrends();
            }
            
            detectTrends() {
                // Identify market trends for player hints
                let trends = [];
                
                for (let name in this.goods) {
                    let good = this.goods[name];
                    if (good.supply < good.demand * 0.5) {
                        trends.push(`${name} shortage developing...`);
                    } else if (good.supply > good.demand * 2) {
                        trends.push(`${name} oversupply, prices falling...`);
                    }
                }
                
                if (trends.length > 0) {
                    document.getElementById('trend').textContent = trends[0];
                } else {
                    document.getElementById('trend').textContent = 'Market is finding equilibrium...';
                }
            }
            
            buy(goodName, amount) {
                let good = this.goods[goodName];
                let cost = good.price * amount;
                
                if (this.playerCash >= cost && good.supply >= amount) {
                    this.playerCash -= cost;
                    this.playerInventory[goodName] += amount;
                    good.supply -= amount;
                    good.demand += amount * 0.5;  // Buying increases demand slightly
                    this.updateDisplay();
                    return true;
                }
                return false;
            }
            
            sell(goodName, amount) {
                if (this.playerInventory[goodName] >= amount) {
                    let good = this.goods[goodName];
                    let revenue = good.price * amount * 0.95;  // Small transaction cost
                    
                    this.playerCash += revenue;
                    this.playerInventory[goodName] -= amount;
                    good.supply += amount;
                    good.demand -= amount * 0.2;  // Selling decreases demand slightly
                    this.updateDisplay();
                    return true;
                }
                return false;
            }
            
            updateDisplay() {
                // Update tick
                document.getElementById('tick').textContent = this.tick;
                
                // Update market display
                let marketHTML = '';
                for (let name in this.goods) {
                    let good = this.goods[name];
                    let arrow = '→';
                    let arrowClass = 'arrow-flat';
                    
                    if (good.prevPrice) {
                        if (good.price > good.prevPrice * 1.01) {
                            arrow = '↑';
                            arrowClass = 'arrow-up';
                        } else if (good.price < good.prevPrice * 0.99) {
                            arrow = '↓';
                            arrowClass = 'arrow-down';
                        }
                    }
                    
                    marketHTML += `
                        <div class="good">
                            <span class="good-name">${name}</span>
                            <span class="price">$${good.price.toFixed(2)} <span class="${arrowClass}">${arrow}</span></span>
                            <span class="supply-demand">S:${good.supply.toFixed(0)} D:${good.demand.toFixed(0)}</span>
                        </div>
                    `;
                }
                document.getElementById('market-display').innerHTML = marketHTML;
                
                // Update agents display
                let agentsHTML = '';
                for (let agent of this.agents) {
                    let efficiency = (agent.efficiency * 100).toFixed(0);
                    agentsHTML += `
                        <div class="agent">
                            ${agent.name}: +${(agent.amount * agent.efficiency).toFixed(1)} ${agent.produces} | 
                            -${agent.needs} ${agent.consumes} | 
                            Eff: ${efficiency}%
                        </div>
                    `;
                }
                document.getElementById('agents-display').innerHTML = agentsHTML;
                
                // Update player display
                document.getElementById('cash').textContent = this.playerCash.toFixed(2);
                
                let invHTML = '';
                for (let good in this.playerInventory) {
                    if (this.playerInventory[good] > 0) {
                        invHTML += `<span class="inv-item">${good}: ${this.playerInventory[good]}</span>`;
                    }
                }
                document.getElementById('inventory').innerHTML = invHTML || 'Empty';
            }
        }
        
        // Initialize economy
        const economy = new Economy();
        economy.updateDisplay();
        
        // Auto-tick every 2 seconds (gentle pace)
        setInterval(() => economy.simulateTick(), 2000);
        
        // UI Functions
        function showBuyModal() {
            closeModals();
            document.getElementById('buyModal').style.display = 'block';
        }
        
        function showSellModal() {
            closeModals();
            document.getElementById('sellModal').style.display = 'block';
        }
        
        function closeModals() {
            document.getElementById('buyModal').style.display = 'none';
            document.getElementById('sellModal').style.display = 'none';
        }
        
        function executeBuy() {
            const good = document.getElementById('buyGood').value;
            const amount = parseInt(document.getElementById('buyAmount').value);
            
            if (amount > 0) {
                if (!economy.buy(good, amount)) {
                    alert('Insufficient funds or supply!');
                }
            }
            closeModals();
        }
        
        function executeSell() {
            const good = document.getElementById('sellGood').value;
            const amount = parseInt(document.getElementById('sellAmount').value);
            
            if (amount > 0) {
                if (!economy.sell(good, amount)) {
                    alert('Insufficient inventory!');
                }
            }
            closeModals();
        }
        
        function wait() {
            // Manual tick
            economy.simulateTick();
        }
        
        function togglePause() {
            economy.paused = !economy.paused;
            document.getElementById('pauseBtn').textContent = economy.paused ? 'RESUME' : 'PAUSE';
        }
        
        // Close modals on escape
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') closeModals();
        });
        
        /*
         * MLEconomy - Proof that economy simulation is simple
         * 
         * Star Citizen: Quantum simulation (doesn't work)
         * MLEconomy: Supply/demand with gentle volatility (works)
         * 
         * Philosophy emerges naturally:
         * - Scarcity drives prices
         * - Agents affect each other
         * - Markets find equilibrium
         * - Speculation can profit
         * 
         * Total lines: ~200
         * Total time: 1 afternoon
         * Chris Roberts: In shambles
         */
    </script>
</body>
</html>